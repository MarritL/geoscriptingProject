---
title: "Explaining roe deer movement in the Italian alps"
authors: Anne-Juul Welsink and Marrit Leenstra
date: 31 January 2019
output: html_notebook
---

TODO:
Project description

```{r}
# check if libraries are installed
if (!require("dplyr")) install.packages("dplyr")
if (!require("sp")) install.packages("sp")
if (!require("DBI")) install.packages("DBI")
if (!require("RSQLite")) install.packages("RSQLite")
```

```{r}
# load libraries
library(dplyr)
library(sp)
library(DBI)
```

```{r}
# import functions
source("R/retrieveData.R")
source("R/saveDataInDB.R")
```

```{r}
# project variables
movementDataURL = "extras.springer.com/2014/978-3-319-03742-4/trackingDB_datasets.zip"
```

```{r}
# download movement data
folder = "data"
retrieveData(movementDataURL, folder)
```

We use roe deer movement data designed as an example dataset for a book about spatial database management (Urbano and Cagnacci, 2014). The data is thus designed for use in a database and set up as interlinking datasets. We decided to use the data as it was designed and set up a SQLite database in memory.

```{r}
# create database connection
movementDB <- dbConnect(RSQLite::SQLite(), "")

# get files
gpsData <- list.files(path = "data/tracking_db/data/sensors_data/", pattern = glob2rx('GSM0*.csv'), full.names = TRUE)
sensorsAnimals <- list.files(path = "data/tracking_db/data/sensors_animals/", pattern = glob2rx('*.csv'), full.names = TRUE)
sensors <- list.files(path = "data/tracking_db/data/sensors/", pattern = glob2rx('*.csv'), full.names = TRUE)
animals <- list.files(path = "data/tracking_db/data/animals/", pattern = glob2rx('*.csv'), full.names = TRUE)

# specify column names for database tables
gpsDataColumnNames <- c("gpsSensorsCode","lineNo", "utcDate", "utcTime", "lmtDate", "lmtTime", "ecefX", "ecefY","ecefZ", "latitude", "longitude", 
"height", "dop", "nav", "validated", "satsUsed", "ch01SatId", "ch01SatCnr", "ch02SatId", "ch02SatCnr", "ch03SatId", "ch03SatCnr", "ch04SatId", "ch04SatCnr", "ch05SatId", "ch05SatCnr", "ch06SatId", "ch06SatCnr", "ch07SatId", "ch07SatCnr", "ch08SatId", "ch08SatCnr", "ch09SatId", "ch09SatCnr", "ch10SatId", "ch10SatCnr", "ch11SatId", "ch11SatCnr", "ch12SatId", "ch12SatCnr", "mainVol", "buVol", "temp", "easting", "northing", "remarks")
sensorsAnimalsColumnNames <- c("animalsId","gpsSensorsId","startTime","EndTime","notes")
sensorsColumnNames <-c("gpsSensorsId", "gpsSensorsCode", "purchaseDate", "frequency", "vendor","model","sim")
animalsColumnNames <- c("animalsCode", "name","sex","ageClassCode", "speciesCode", "note")

# save data in database
saveDataInDB(gpsData, movementDB, "gpsData", gpsDataColumnNames)
saveDataInDB(sensorsAnimals, movementDB, "sensorsAnimals", sensorsAnimalsColumnNames)
saveDataInDB(sensors, movementDB, "sensors", sensorsColumnNames)
saveDataInDB(animals, movementDB, "animals", animalsColumnNames)
```

```{r}
# use data
dbListTables(movementDB)
dbListFields(movementDB, "gpsData")
dbListFields(movementDB, "animals")
dbGetQuery(movementDB, 'SELECT "GPSSensorsCode", "latitude", "longitude" FROM GPSDATA WHERE "GPSSensorsCode" in ("GSM01508", "GSM01438")')
```

```{r}
# disconnect database
dbDisconnect(movementDB)
```

## References
Urbano, F., & Cagnacci, F. (2014). Spatial database for GPS wildlife tracking data. Springer International Publishing.